# 실행 컨텍스트와 클로저 #

# 5.1 실행 컨텍스트 개념 #
* 실행 가능한 코드 블록이 실행되는 환경
* 실행에 필요한 여러 가지 정보를 담고 있다.
* 실행 컨텍스트가 형성되는 경우 세 가지
    * 전역 코드
    * eval() 함수로 실행되는 코드
    * 함수안에 코드 실행

<dl>
    <dt>
        실행 컨텍스트의 생성
    </dt>
    <dd>
        <strong>현재 실행되는 컨텍스튼에서 이 컨텍스트와 관련 없는 실행 코드가 실행되면, 새로운 컨텍스트가 생성되어 스택에 들어가고 제어권이 그 컨텍스트로 이동한다.</strong>
    </dd>
</dl>

*예제 5-1*
```js
    console.log("This is global context");

    function ExContext1() {
        console.log("This is ExContext1");
    };

    function ExContext2() {
        ExContext1();
        console.log("This is ExContext2");
    }

    ExContext2();       //  This is global context 
                        //  This is ExContext1
                        //  This is ExContext2
```

## 5.2 실행 컨텍스트 생성 과정 ##
* 활성 객체와 변수 객체
* 스코프 체인

*예제 5-2*
```js
    function execute(param1, param2) {
        var a = 1, b = 2;
        function func() {
            return a+b;
        }
        return param1 + param2 + func();
    }

    execute(3,4);

    /*  
        실행 컨텍스트 스택

        1. func 실행 컨텍스트 (최상위)
        2. execute 컨텍스트 
        3. 전역 컨텍스트
    */
```

### 5.2.1 활성 객체 생성 ###
실행 컨텍스트가 생성되면 해당 컨텍스트에서 실행에 필요한 여러 가지 정보를 담을 객체를 생성하는데, 이를 활성 객체라고 한다.

*여러 가지 정보*
* 매개변수
* 사용자가 정의한 변수 및 객체

### 5.2.2 arguments 객체 생성 ###
활성 객체는 arguments 프로퍼티로 arguments 객체를 참조한다.

### 5.2.3. 스코프 정보 생성 ###
* 현재 컨텍스트의 유효 범위 나타내는 스코프 정보를 생성한다.
* 실행 중인 컨텍스트 안에서 연결 리스트와 유사한 형식으로 만들어진다.
* 해당 컨텍스트에서 특정 변수에 접근해야 할 경우, 이 리스트를 활용한다.
* 스코프 체인이라고 하며 [[scope]] 프로퍼티로 참조된다.


### 5.2.4 변수 생성 ###
* 앞서 생성된 활성 객체는 변수 객체와 명명만 틀릴 뿐 같은 객체이다.
* 호출된 함수 인자는 각각의 프로퍼티가 만들어지고 그 값이 할당된다.
* 함수 안에 정의된 변수와 내부함수가 생성된다. **(메모리에 생성하고, 초기화는 각 변수나 함수에 해당 표현식이 실행되기 전까지 이루어지지 않는다.)**

### 5.2.5 this 바인딩 ###
this 키워드를 사용하는 값이 할당된다

### 5.2.6 코드 실행 ###
변수 객체가 만들어진 후에, 코드에 있는 여러 가지 표현식 실행이 이루어진다.

<dl>
    <dt>
        전역 실행 컨텍스트
    </dt>
    <dd>
        arguments 객체가 없다.
    </dd>
    <dd>
        전역 객체 하나만 포함하는 스코프 체인이 있다.
    </dd>
    <dd>
        전역 코드가 실행될 때 생성된다.
    </dd>
    <dd>
        변수를 초기화하고 이것의 내부 함수는 일반적인 탑 레벨의 함수로 선언된다.
    </dd>
    <dd>
        변수 객체가 곧 전역 객체다
    </dd>
</dl>

<em>Node.js에서의 최상위 코드는 전역 코드가 아니다</em>
일반적으로 자바스크립트 파일, 이를테면 filename.js가 하나의 모듈로 동작하고 이 파일의 최상위에 변수를 선언해도 **그 모듈의 지역 변수**가 된다.<br> 하지만 var를 사용하지 않을 경우 전역 객체인 global에 들어가고, 이는 전역 객체를 오염시키는 원인이 되므로 주의해야 한다.
```js
    var a = 10;
    b = 15;

    console.log(global.a);  //  undefined
    console.log(global.b);  //  15
```
